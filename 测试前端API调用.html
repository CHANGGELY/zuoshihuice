<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试前端API调用</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .success {
            border-color: #4CAF50;
            background: #e8f5e8;
        }
        .error {
            border-color: #f44336;
            background: #ffeaea;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>测试前端API调用</h1>
    
    <div>
        <h3>测试参数：</h3>
        <ul>
            <li>策略: grid_making</li>
            <li>初始资金: 10000 USDC</li>
            <li>杠杆: 125倍</li>
            <li>开始日期: 2024-06-15</li>
            <li>结束日期: 2024-07-14</li>
            <li>价差: 0.002</li>
        </ul>
    </div>
    
    <button id="testBtn" onclick="testAPI()">开始测试回测API</button>
    
    <div id="result"></div>

    <script>
        async function testAPI() {
            const btn = document.getElementById('testBtn');
            const resultDiv = document.getElementById('result');
            
            btn.disabled = true;
            btn.textContent = '测试中...';
            
            try {
                // 测试参数
                const params = {
                    strategy: 'grid_making',
                    initial_capital: 10000,
                    leverage: 125,
                    start_date: '2024-06-15',
                    end_date: '2024-07-14',
                    bid_spread: 0.002,
                    ask_spread: 0.002
                };
                
                console.log('发送请求参数:', params);
                
                // 发送请求
                const response = await fetch('http://localhost:8000/api/v1/backtest/run/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(params)
                });
                
                console.log('响应状态码:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status} ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('响应结果:', result);
                
                if (result.success) {
                    const data = result.data;
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>✅ 回测成功!</h3>
                            <p><strong>总收益率:</strong> ${(data.total_return * 100).toFixed(2)}%</p>
                            <p><strong>最大回撤:</strong> ${(data.max_drawdown * 100).toFixed(2)}%</p>
                            <p><strong>交易次数:</strong> ${data.total_trades}</p>
                            <p><strong>最终资金:</strong> ${data.final_capital.toFixed(2)} USDC</p>
                            <p><strong>交易记录数量:</strong> ${data.trades ? data.trades.length : 0}</p>
                            ${data.trades && data.trades.length > 100 ? 
                                '<p><strong>✅ 这是真实的专业回测数据!</strong></p>' : 
                                '<p><strong>❌ 交易数据不足</strong></p>'
                            }
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>❌ 回测失败</h3>
                            <p>错误信息: ${result.error}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('请求失败:', error);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ 请求失败</h3>
                        <p>错误信息: ${error.message}</p>
                        <p>请检查:</p>
                        <ul>
                            <li>后端服务是否运行在 http://localhost:8000</li>
                            <li>CORS配置是否正确</li>
                            <li>网络连接是否正常</li>
                        </ul>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.textContent = '开始测试回测API';
            }
        }
    </script>
</body>
</html>
