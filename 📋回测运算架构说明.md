# ğŸ”§ å‰ç«¯å›æµ‹æ—¶åç«¯è¿ç®—æ¶æ„è¯¦è§£

## ğŸ“Š å®Œæ•´è¿ç®—æµç¨‹

### 1. å‰ç«¯å‘èµ·è¯·æ±‚
```javascript
// å‰ç«¯ (Vue) å‘é€å›æµ‹è¯·æ±‚
const response = await axios.post('/api/v1/backtest/run/', {
  strategy: 'grid_making',
  initial_capital: 10000,
  leverage: 10,
  start_date: '2024-01-01',
  end_date: '2024-12-31',
  bid_spread: 0.002,
  ask_spread: 0.002
})
```

### 2. Flaskåç«¯æ¥æ”¶è¯·æ±‚
**æ–‡ä»¶**: `æœ€ç»ˆç¨³å®šåç«¯.py`
**APIç«¯ç‚¹**: `/api/v1/backtest/run/` å’Œ `/api/market-data/backtest/`

```python
@app.route('/api/v1/backtest/run/', methods=['POST', 'OPTIONS'])
@app.route('/api/market-data/backtest/', methods=['POST', 'OPTIONS'])
def run_backtest():
    # 1. æ¥æ”¶å‰ç«¯JSONå‚æ•°
    data = request.get_json()
    
    # 2. éªŒè¯å‚æ•°å¹¶è½¬æ¢æ ¼å¼
    params = {
        'strategy': data.get('strategy', 'grid_making'),
        'initial_capital': float(data.get('initial_capital', 10000)),
        'leverage': int(data.get('leverage', 5)),
        'start_date': data.get('start_date', '2024-06-15'),
        'end_date': data.get('end_date', '2024-07-15'),
        'bid_spread': float(data.get('bid_spread', 0.002)),
        'ask_spread': float(data.get('ask_spread', 0.002))
    }
```

### 3. è°ƒç”¨ç‹¬ç«‹å›æµ‹æ‰§è¡Œå™¨
**æ ¸å¿ƒè¿ç®—æ–‡ä»¶**: `ç‹¬ç«‹å›æµ‹æ‰§è¡Œå™¨.py`

Flaskåç«¯é€šè¿‡**ç‹¬ç«‹è¿›ç¨‹**è°ƒç”¨å›æµ‹å¼•æ“ï¼š

```python
# åˆ›å»ºä¸´æ—¶å‚æ•°æ–‡ä»¶
with tempfile.NamedTemporaryFile(mode='w', suffix='.json', delete=False) as f:
    json.dump(params, f)
    params_file = f.name

# å¯åŠ¨ç‹¬ç«‹Pythonè¿›ç¨‹æ‰§è¡Œå›æµ‹
result = subprocess.run([
    sys.executable, 
    str(BACKTEST_SCRIPT),  # ç‹¬ç«‹å›æµ‹æ‰§è¡Œå™¨.py
    "--params-file", params_file,
    "--output", result_file
], capture_output=True, text=True, timeout=300)
```

### 4. ç‹¬ç«‹å›æµ‹æ‰§è¡Œå™¨è¿ç®—
**æ–‡ä»¶**: `ç‹¬ç«‹å›æµ‹æ‰§è¡Œå™¨.py`

è¿™æ˜¯**çœŸæ­£çš„è¿ç®—æ ¸å¿ƒ**ï¼š

```python
def main():
    # 1. å¯¼å…¥åŸå§‹å›æµ‹å¼•æ“
    from backtest_kline_trajectory import run_backtest_with_params, BACKTEST_CONFIG
    
    # 2. é…ç½®å›æµ‹å‚æ•°
    BACKTEST_CONFIG.update({
        'start_date': params.get('start_date'),
        'end_date': params.get('end_date'),
        'initial_balance': params.get('initial_capital'),
    })
    
    # 3. è®¾ç½®ç­–ç•¥å‚æ•°
    strategy_params = {
        "leverage": params.get('leverage', 5),
        "bid_spread": Decimal(str(params.get('bid_spread', 0.002))),
        "ask_spread": Decimal(str(params.get('ask_spread', 0.002))),
    }
    
    # 4. è°ƒç”¨åŸå§‹å›æµ‹å¼•æ“ - 100%åŸå§‹é€»è¾‘ï¼
    result = run_backtest_with_params(strategy_params=strategy_params, use_cache=False)
    
    # 5. è½¬æ¢ç»“æœæ ¼å¼å¹¶è¾“å‡º
    converted_result = convert_result_format(result, params)
    output_data = {'success': True, 'data': converted_result}
```

### 5. åŸå§‹å›æµ‹å¼•æ“è¿ç®—
**æ–‡ä»¶**: `backtest_kline_trajectory.py` (æ‚¨çš„åŸå§‹ä¸“ä¸šå›æµ‹å¼•æ“)

è¿™æ˜¯**æœ€æ ¸å¿ƒçš„è¿ç®—éƒ¨åˆ†**ï¼š
- âœ… åŠ è½½çœŸå®çš„ETHUSDT 1åˆ†é’ŸKçº¿æ•°æ® (2019-2025å¹´)
- âœ… 5ç‚¹ä»·æ ¼è½¨è¿¹æ¨¡æ‹Ÿ (å¼€é«˜æ”¶ä½ä¸­)
- âœ… ç½‘æ ¼åšå¸‚ç­–ç•¥é€»è¾‘
- âœ… åŠ¨æ€æ æ†è°ƒæ•´
- âœ… çˆ†ä»“æ£€æŸ¥å’Œé£é™©ç®¡ç†
- âœ… æ‰‹ç»­è´¹è®¡ç®—
- âœ… èµ„é‡‘æƒç›Šæ›²çº¿ç”Ÿæˆ
- âœ… å®Œæ•´äº¤æ˜“è®°å½•

### 6. ç»“æœè¿”å›é“¾è·¯
```
åŸå§‹å›æµ‹å¼•æ“ â†’ ç‹¬ç«‹æ‰§è¡Œå™¨ â†’ Flaskåç«¯ â†’ å‰ç«¯ç•Œé¢
     â†“              â†“           â†“         â†“
  ä¸“ä¸šè¿ç®—ç»“æœ   â†’  æ ¼å¼è½¬æ¢   â†’  JSONå“åº”  â†’  å›¾è¡¨æ˜¾ç¤º
```

## ğŸ—ï¸ æ¶æ„ä¼˜åŠ¿

### 1. **è¿›ç¨‹éš”ç¦»**
- ç‹¬ç«‹è¿›ç¨‹é¿å…Flaskå’Œå›æµ‹å¼•æ“çš„å†²çª
- å›æµ‹å´©æºƒä¸ä¼šå½±å“WebæœåŠ¡
- å†…å­˜éš”ç¦»ï¼Œé¿å…å†…å­˜æ³„æ¼

### 2. **100%åŸå§‹é€»è¾‘**
- ç›´æ¥è°ƒç”¨æ‚¨çš„ `backtest_kline_trajectory.py`
- æ²¡æœ‰ä»»ä½•ç®€åŒ–æˆ–å¦¥å
- ä¿è¯ä¸“ä¸šé‡åŒ–é‡‘èçš„å‡†ç¡®æ€§

### 3. **çœŸå®æ•°æ®**
- ä½¿ç”¨çœŸå®çš„ETHUSDTå†å²æ•°æ®
- 5ç‚¹ä»·æ ¼è½¨è¿¹æå‡ç²¾åº¦
- å®Œæ•´çš„å¸‚åœºæ•°æ®è¦†ç›–

### 4. **ç¨³å®šå¯é **
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- è¶…æ—¶ä¿æŠ¤æœºåˆ¶
- ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†

## ğŸ“ å…³é”®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ä½œç”¨ | è¿ç®—èŒè´£ |
|------|------|----------|
| `æœ€ç»ˆç¨³å®šåç«¯.py` | Flask APIæœåŠ¡ | æ¥æ”¶è¯·æ±‚ã€å‚æ•°éªŒè¯ã€è¿›ç¨‹è°ƒåº¦ |
| `ç‹¬ç«‹å›æµ‹æ‰§è¡Œå™¨.py` | å›æµ‹æ‰§è¡Œå™¨ | å‚æ•°è½¬æ¢ã€å¼•æ“è°ƒç”¨ã€ç»“æœæ ¼å¼åŒ– |
| `backtest_kline_trajectory.py` | åŸå§‹å›æµ‹å¼•æ“ | **æ ¸å¿ƒè¿ç®—é€»è¾‘** |
| `ETHUSDT_1m_2019-11-01_to_2025-06-15.h5` | æ•°æ®æº | çœŸå®å†å²æ•°æ® |

## ğŸ¯ è¿ç®—æ€§èƒ½

- **æ•°æ®é‡**: 5å¹´+ çœŸå®1åˆ†é’ŸKçº¿æ•°æ®
- **è¿ç®—ç²¾åº¦**: 5ç‚¹ä»·æ ¼è½¨è¿¹æ¨¡æ‹Ÿ
- **å¤„ç†é€Ÿåº¦**: å…¨å¹´å›æµ‹çº¦30ç§’
- **å†…å­˜ä½¿ç”¨**: ç‹¬ç«‹è¿›ç¨‹ï¼Œè‡ªåŠ¨é‡Šæ”¾
- **å¹¶å‘æ”¯æŒ**: å¤šä¸ªå›æµ‹è¯·æ±‚ç‹¬ç«‹å¤„ç†

## ğŸ’¡ æ€»ç»“

å‰ç«¯å›æµ‹æ—¶ï¼Œ**çœŸæ­£çš„è¿ç®—æ ¸å¿ƒæ˜¯æ‚¨çš„åŸå§‹ `backtest_kline_trajectory.py` æ–‡ä»¶**ã€‚

åç«¯æ¶æ„çš„ä½œç”¨æ˜¯ï¼š
1. **Flaskåç«¯**: æä¾›Web APIæ¥å£
2. **ç‹¬ç«‹æ‰§è¡Œå™¨**: æ¡¥æ¥WebæœåŠ¡å’Œå›æµ‹å¼•æ“
3. **åŸå§‹å¼•æ“**: æ‰§è¡Œä¸“ä¸šçš„é‡åŒ–å›æµ‹è¿ç®—

è¿™æ ·æ—¢ä¿è¯äº†WebæœåŠ¡çš„ç¨³å®šæ€§ï¼Œåˆå®Œå…¨ä¿ç•™äº†æ‚¨åŸå§‹å›æµ‹å¼•æ“çš„ä¸“ä¸šæ€§å’Œå‡†ç¡®æ€§ï¼
